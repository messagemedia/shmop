<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>shmop: MessageMedia\shmop\SharedMemoryOp Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">shmop
   </div>
   <div id="projectbrief">Shared memory manipulation library for PHP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classMessageMedia_1_1shmop_1_1SharedMemoryOp.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">MessageMedia\shmop\SharedMemoryOp Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Provides structure for reading and writing to shared memory segments using PHPs shmop_* functions.  
 <a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#details">More...</a></p>
<div class="dynheader">
Inheritance diagram for MessageMedia\shmop\SharedMemoryOp:</div>
<div class="dyncontent">
<div class="center"><img src="classMessageMedia_1_1shmop_1_1SharedMemoryOp__inherit__graph.png" border="0" usemap="#MessageMedia_0Cshmop_0CSharedMemoryOp_inherit__map" alt="Inheritance graph"/></div>
<map name="MessageMedia_0Cshmop_0CSharedMemoryOp_inherit__map" id="MessageMedia_0Cshmop_0CSharedMemoryOp_inherit__map">
<area shape="rect" id="node3" href="classMessageMedia_1_1shmop_1_1metrics_1_1MetricsLogger.html" title="Provides a structure for implementing counter and timer style application level metrics within PHP..." alt="" coords="31,169,186,211"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for MessageMedia\shmop\SharedMemoryOp:</div>
<div class="dyncontent">
<div class="center"><img src="classMessageMedia_1_1shmop_1_1SharedMemoryOp__coll__graph.png" border="0" usemap="#MessageMedia_0Cshmop_0CSharedMemoryOp_coll__map" alt="Collaboration graph"/></div>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a580004299ebcba7bba9b1da4a88abf28"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a580004299ebcba7bba9b1da4a88abf28">__construct</a> ($name, $identifier, $version, $mode=self::MODE_READ_WRITE)</td></tr>
<tr class="memdesc:a580004299ebcba7bba9b1da4a88abf28"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct a <a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html" title="Provides structure for reading and writing to shared memory segments using PHPs shmop_* functions...">SharedMemoryOp</a> object.  <a href="#a580004299ebcba7bba9b1da4a88abf28">More...</a><br /></td></tr>
<tr class="separator:a580004299ebcba7bba9b1da4a88abf28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a653182f25b35241f800eab714549faba"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a653182f25b35241f800eab714549faba"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a653182f25b35241f800eab714549faba">__get</a> ($name)</td></tr>
<tr class="memdesc:a653182f25b35241f800eab714549faba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Derived classes must implement a getter function. <br /></td></tr>
<tr class="separator:a653182f25b35241f800eab714549faba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ead8e4dac55dc17fccaa2b2e6f1761c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0ead8e4dac55dc17fccaa2b2e6f1761c"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a0ead8e4dac55dc17fccaa2b2e6f1761c">__set</a> ($name, $value)</td></tr>
<tr class="memdesc:a0ead8e4dac55dc17fccaa2b2e6f1761c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Derived classes must implement a setter function. <br /></td></tr>
<tr class="separator:a0ead8e4dac55dc17fccaa2b2e6f1761c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade0888a95912c34dc46ae3920175312f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ade0888a95912c34dc46ae3920175312f"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#ade0888a95912c34dc46ae3920175312f">deleteSharedMemory</a> ($deleteKeyFile=true)</td></tr>
<tr class="memdesc:ade0888a95912c34dc46ae3920175312f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deletes the shared memory segements. <br /></td></tr>
<tr class="separator:ade0888a95912c34dc46ae3920175312f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23377d1e4cedd9c6847091c3778d9f28"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a23377d1e4cedd9c6847091c3778d9f28">isError</a> ()</td></tr>
<tr class="memdesc:a23377d1e4cedd9c6847091c3778d9f28"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the value of hasError.  <a href="#a23377d1e4cedd9c6847091c3778d9f28">More...</a><br /></td></tr>
<tr class="separator:a23377d1e4cedd9c6847091c3778d9f28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf854871dda21a6a950f85119eadc624"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#acf854871dda21a6a950f85119eadc624">getName</a> ()</td></tr>
<tr class="memdesc:acf854871dda21a6a950f85119eadc624"><td class="mdescLeft">&#160;</td><td class="mdescRight">Getter for the name property.  <a href="#acf854871dda21a6a950f85119eadc624">More...</a><br /></td></tr>
<tr class="separator:acf854871dda21a6a950f85119eadc624"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb85506a3a08b9e2eca3acd2fbba5cac"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#aeb85506a3a08b9e2eca3acd2fbba5cac">getidentifier</a> ()</td></tr>
<tr class="memdesc:aeb85506a3a08b9e2eca3acd2fbba5cac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Getter for the identifier property.  <a href="#aeb85506a3a08b9e2eca3acd2fbba5cac">More...</a><br /></td></tr>
<tr class="separator:aeb85506a3a08b9e2eca3acd2fbba5cac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedd7d6cab3ed9c5007687fd419a48bd2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#aedd7d6cab3ed9c5007687fd419a48bd2">getIpcKeyFile</a> ()</td></tr>
<tr class="memdesc:aedd7d6cab3ed9c5007687fd419a48bd2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Getter for the ipcKeyFile property.  <a href="#aedd7d6cab3ed9c5007687fd419a48bd2">More...</a><br /></td></tr>
<tr class="separator:aedd7d6cab3ed9c5007687fd419a48bd2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a4188ad5aa09d0779863074b191f0194f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4188ad5aa09d0779863074b191f0194f"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a4188ad5aa09d0779863074b191f0194f">MODE_READ_ONLY</a> = 'r'</td></tr>
<tr class="memdesc:a4188ad5aa09d0779863074b191f0194f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open shared memory segments for reading only. <br /></td></tr>
<tr class="separator:a4188ad5aa09d0779863074b191f0194f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a989d02593b404404bf9d06c7fc4b9cbe"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a989d02593b404404bf9d06c7fc4b9cbe"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a989d02593b404404bf9d06c7fc4b9cbe">MODE_READ_WRITE</a> = 'w'</td></tr>
<tr class="memdesc:a989d02593b404404bf9d06c7fc4b9cbe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open shared memory segments for reading and writing. <br /></td></tr>
<tr class="separator:a989d02593b404404bf9d06c7fc4b9cbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada4f2481df07a80e575531d9a168e316"><td class="memItemLeft" align="right" valign="top">const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#ada4f2481df07a80e575531d9a168e316">IPC_KEY_FILE_PATH</a> = '/var/tmp/'</td></tr>
<tr class="separator:ada4f2481df07a80e575531d9a168e316"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5488145d3a852e5e17b5e902814cf6f2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5488145d3a852e5e17b5e902814cf6f2"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a5488145d3a852e5e17b5e902814cf6f2">PAGE_SIZE</a> = 4096</td></tr>
<tr class="memdesc:a5488145d3a852e5e17b5e902814cf6f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Page size used on most MessageMedia production servers. <br /></td></tr>
<tr class="separator:a5488145d3a852e5e17b5e902814cf6f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59d822532221ef70792a1fcd279d1679"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a59d822532221ef70792a1fcd279d1679"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a59d822532221ef70792a1fcd279d1679">LOCK_WAIT_TIMEOUT</a> = 100</td></tr>
<tr class="memdesc:a59d822532221ef70792a1fcd279d1679"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default maximum time, in milliseconds, to wait for a lock. <br /></td></tr>
<tr class="separator:a59d822532221ef70792a1fcd279d1679"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ec45b2edf75f90dabeaead4d913ae95"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8ec45b2edf75f90dabeaead4d913ae95"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a8ec45b2edf75f90dabeaead4d913ae95">FTOK_PROJECT_INDEX_IDENTIFIER</a> = 'i'</td></tr>
<tr class="memdesc:a8ec45b2edf75f90dabeaead4d913ae95"><td class="mdescLeft">&#160;</td><td class="mdescRight">ftok project identifier for index segment. <br /></td></tr>
<tr class="separator:a8ec45b2edf75f90dabeaead4d913ae95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac22d19f5b047cbd2bfe745163a1f3ac6"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac22d19f5b047cbd2bfe745163a1f3ac6"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#ac22d19f5b047cbd2bfe745163a1f3ac6">FTOK_PROJECT_DATA_IDENTIFIER</a> = 'd'</td></tr>
<tr class="memdesc:ac22d19f5b047cbd2bfe745163a1f3ac6"><td class="mdescLeft">&#160;</td><td class="mdescRight">ftok project identifier for data segment. <br /></td></tr>
<tr class="separator:ac22d19f5b047cbd2bfe745163a1f3ac6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a672c263b79ecf01cd3529c195ae8d25a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a672c263b79ecf01cd3529c195ae8d25a"></a>
const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a672c263b79ecf01cd3529c195ae8d25a">SHARED_MEMORY_MODE</a> = 0644</td></tr>
<tr class="memdesc:a672c263b79ecf01cd3529c195ae8d25a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Access mode to use when creating shared memory segments. <br /></td></tr>
<tr class="separator:a672c263b79ecf01cd3529c195ae8d25a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a3a1387fcad63b85e8851a168bcc3d0a5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a3a1387fcad63b85e8851a168bcc3d0a5">initializeSharedMemorySegment</a> ()</td></tr>
<tr class="memdesc:a3a1387fcad63b85e8851a168bcc3d0a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes a shared memory segment.  <a href="#a3a1387fcad63b85e8851a168bcc3d0a5">More...</a><br /></td></tr>
<tr class="separator:a3a1387fcad63b85e8851a168bcc3d0a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25a1a566f390a8885c689230343054f1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a25a1a566f390a8885c689230343054f1">openOrCreate</a> ($projectIdentifier, $pages)</td></tr>
<tr class="memdesc:a25a1a566f390a8885c689230343054f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Opens or creates a shared memory segment.  <a href="#a25a1a566f390a8885c689230343054f1">More...</a><br /></td></tr>
<tr class="separator:a25a1a566f390a8885c689230343054f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a495801c80c6c22770b1cfba0345cc1b9"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a495801c80c6c22770b1cfba0345cc1b9">getHead</a> ()</td></tr>
<tr class="memdesc:a495801c80c6c22770b1cfba0345cc1b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function for getting the head data (version, nextIndexOffset, nextDataOffset) from the index shared memory segment.  <a href="#a495801c80c6c22770b1cfba0345cc1b9">More...</a><br /></td></tr>
<tr class="separator:a495801c80c6c22770b1cfba0345cc1b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99d4030b744dba40e4e857125a30ba6f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a99d4030b744dba40e4e857125a30ba6f"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a99d4030b744dba40e4e857125a30ba6f">getHeadStructure</a> ()</td></tr>
<tr class="memdesc:a99d4030b744dba40e4e857125a30ba6f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the head structure of the index. <br /></td></tr>
<tr class="separator:a99d4030b744dba40e4e857125a30ba6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada1bd3c706e07ad3cfb58d1177065017"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#ada1bd3c706e07ad3cfb58d1177065017">getLock</a> (&amp;$fp, $lock, $timeout=self::LOCK_WAIT_TIMEOUT)</td></tr>
<tr class="memdesc:ada1bd3c706e07ad3cfb58d1177065017"><td class="mdescLeft">&#160;</td><td class="mdescRight">Attempts to get a lock on the file handle $fp within the specified timeout, specified by $timeout.  <a href="#ada1bd3c706e07ad3cfb58d1177065017">More...</a><br /></td></tr>
<tr class="separator:ada1bd3c706e07ad3cfb58d1177065017"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:a662bef2e443b622b49fdfe187744c914"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a662bef2e443b622b49fdfe187744c914"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a662bef2e443b622b49fdfe187744c914">$version</a> = 1</td></tr>
<tr class="memdesc:a662bef2e443b622b49fdfe187744c914"><td class="mdescLeft">&#160;</td><td class="mdescRight">Version of the data structure being stored. <br /></td></tr>
<tr class="separator:a662bef2e443b622b49fdfe187744c914"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af46b1a831190aed3fb5fc372de55b56f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af46b1a831190aed3fb5fc372de55b56f"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#af46b1a831190aed3fb5fc372de55b56f">$name</a> = ''</td></tr>
<tr class="memdesc:af46b1a831190aed3fb5fc372de55b56f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Name for the shared memory segment. <br /></td></tr>
<tr class="separator:af46b1a831190aed3fb5fc372de55b56f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f8b4dfcf0544927d0ea941de4180ba9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9f8b4dfcf0544927d0ea941de4180ba9"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a9f8b4dfcf0544927d0ea941de4180ba9">$identifier</a> = ''</td></tr>
<tr class="memdesc:a9f8b4dfcf0544927d0ea941de4180ba9"><td class="mdescLeft">&#160;</td><td class="mdescRight">A secondary identifier to be used with the $name. <br /></td></tr>
<tr class="separator:a9f8b4dfcf0544927d0ea941de4180ba9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a848853ba8bd5c53dae6e9bb9cfc5f2ad"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a848853ba8bd5c53dae6e9bb9cfc5f2ad"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a848853ba8bd5c53dae6e9bb9cfc5f2ad">$shmIndexId</a> = false</td></tr>
<tr class="memdesc:a848853ba8bd5c53dae6e9bb9cfc5f2ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shared memory ID for the index returned by shmop_open(). <br /></td></tr>
<tr class="separator:a848853ba8bd5c53dae6e9bb9cfc5f2ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e14fd773dd07f90e851e5fa3ad19c27"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0e14fd773dd07f90e851e5fa3ad19c27"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a0e14fd773dd07f90e851e5fa3ad19c27">$shmDataId</a> = false</td></tr>
<tr class="memdesc:a0e14fd773dd07f90e851e5fa3ad19c27"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shared memory ID for the data returned by shmop_open(). <br /></td></tr>
<tr class="separator:a0e14fd773dd07f90e851e5fa3ad19c27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acda9178e320237d34d6304aa264427cd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acda9178e320237d34d6304aa264427cd"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#acda9178e320237d34d6304aa264427cd">$shmIndexPages</a> = 1</td></tr>
<tr class="memdesc:acda9178e320237d34d6304aa264427cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of pages to reserve for index shared memory segment on creation. <br /></td></tr>
<tr class="separator:acda9178e320237d34d6304aa264427cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59c005b8a4e0bc6dbb5ae236a66b7e3a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a59c005b8a4e0bc6dbb5ae236a66b7e3a"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a59c005b8a4e0bc6dbb5ae236a66b7e3a">$shmDataPages</a> = 1</td></tr>
<tr class="memdesc:a59c005b8a4e0bc6dbb5ae236a66b7e3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of pages to reserve for data shared memory segment on creation. <br /></td></tr>
<tr class="separator:a59c005b8a4e0bc6dbb5ae236a66b7e3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40f3d151f0cbdc48478240a40caf7ddc"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a40f3d151f0cbdc48478240a40caf7ddc"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a40f3d151f0cbdc48478240a40caf7ddc">$ipcKeyFile</a> = false</td></tr>
<tr class="memdesc:a40f3d151f0cbdc48478240a40caf7ddc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Path to file used when creating System V IPC Key. <br /></td></tr>
<tr class="separator:a40f3d151f0cbdc48478240a40caf7ddc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0651379f6bbeb81af861887f942942e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa0651379f6bbeb81af861887f942942e"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#aa0651379f6bbeb81af861887f942942e">$hasError</a> = false</td></tr>
<tr class="memdesc:aa0651379f6bbeb81af861887f942942e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag any permanent errors. <br /></td></tr>
<tr class="separator:aa0651379f6bbeb81af861887f942942e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a114fa3971b7700246999c7c4152b9b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9a114fa3971b7700246999c7c4152b9b"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a9a114fa3971b7700246999c7c4152b9b">$readOnly</a> = false</td></tr>
<tr class="memdesc:a9a114fa3971b7700246999c7c4152b9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open shared memory segments as read only. <br /></td></tr>
<tr class="separator:a9a114fa3971b7700246999c7c4152b9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b9da8603edb684c107435d2eb4a3e9b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a8b9da8603edb684c107435d2eb4a3e9b">$versionStructure</a></td></tr>
<tr class="separator:a8b9da8603edb684c107435d2eb4a3e9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f686dd9edce30ea188f69489a0a5764"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a9f686dd9edce30ea188f69489a0a5764">$offsetsStructure</a></td></tr>
<tr class="separator:a9f686dd9edce30ea188f69489a0a5764"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Provides structure for reading and writing to shared memory segments using PHPs shmop_* functions. </p>
<p>Two shared memory segments are opened or created if they don't already exist. The first segment is for storing an index of offsets, which references the second segment where the actual data is stored.</p>
<p>The index segment contains a 12 byte header containing a version number, next index offset (the offset at which a new index can be written to the index segment) and next data offset (the offset at which a new data item can be written to the data segment). These three values are unsigned 32 bit integers.</p>
<p>Derived classes should implement the following functionality:</p>
<ul>
<li><p class="startli">An index structure which creates a unique identifier for a data item to be stored, that item's offset (in bytes) in the data segment, the type of data being stored and its length. For example, an index may has a structrue: name (char) type (char) length (uint16) offset (uint32)</p>
<p class="startli">Resulting in an index that looks like: 'a C 1 0' (the type C referrs to an unsigned char, see: <a href="http://php.net/manual/en/function.pack.php">http://php.net/manual/en/function.pack.php</a>) which says that data item 'a' is a char stored at offset 0 in the data segment. The value for item 'a' can then be read and written using shmop_read and shmop_write using the length and offset values.</p>
</li>
<li>A method for searching through the index to find the offset and length for a value based on its unique identifer. Using the above index as an example, looking up 'a' would return an offset of 0 and a length of 1, and optionally store the offset value somewhere to save further lookups.</li>
<li>A method for adding a value to the index.</li>
<li>Implementation of the __get and __set functions which use shmop_read and shmop_write on the data segment ($shmDataId), using the offset and length values of the value being read or written. A possible implementation of the __get function: lookup the offset and length of the value return data of the values length at the values offset in the data segment or false if the value doesn't exist in the index A possible implementation of the __set function: lookup the offset and length of the value if the value doesn't exist add it to the index write data of the values length at the values offset in the data segment</li>
</ul>
<p>Shared memory segments require a System V ID, which is created using ftok(), using a temporary file stored in IPC_KEY_FILE_PATH named, using the $name and $identifier passed to the constructor.</p>
<p>This class extends stdClass. By overriding the __get and __set functions, any operations on properties that aren't explicilty defined as properties of this class (or any derived classes), will result in invokation of the __get and possibly __set functions being called (depending on the operation). This allows data to be read and written from shared memory using the following notation: </p><div class="fragment"><div class="line">$object-&gt;foo; <span class="comment">// (invokes __get(&#39;foo&#39;))</span></div><div class="line">$object-&gt;foo = <span class="stringliteral">&#39;baa&#39;</span>; <span class="comment">// (invokes __set(&#39;foo&#39;, &#39;baa&#39;))</span></div><div class="line">$object-&gt;counter++; <span class="comment">// (invokes __get(&#39;counter&#39;) followed by __set(&#39;foo&#39;, n))</span></div><div class="line">                    <span class="comment">// where n is the return of the __get + 1.</span></div></div><!-- fragment --><p>This class uses file locking (flock) on the IPC key file to ensure data consistency. File locking is performed in a non blocking fashion to prevent deadlocks, with a lock wait timeout of 100 milliseconds. If a lock cannot be obtained within the timeout the operation is aborted.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd><p class="startdd">Change the IPC_KEY_FILE_PATH constant to a variable and allow for derived classes to set this value. </p>
<p class="enddd">Change the LOCK_WAIT_TIME constant to a variable and allow for derived classes to set this value.</p>
</dd></dl>
<dl class="section see"><dt>See also</dt><dd>metrics/MetricsLogger.class.php, an implementation of <a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html" title="Provides structure for reading and writing to shared memory segments using PHPs shmop_* functions...">SharedMemoryOp</a>. </dd>
<dd>
Packing.class.php, for helper functions and constants when working with PHP's pack and unpack functions. </dd>
<dd>
<a href="http://php.net/manual/en/function.ftok.php">http://php.net/manual/en/function.ftok.php</a> </dd>
<dd>
<a href="http://www.php.net/manual/en/book.shmop.php">http://www.php.net/manual/en/book.shmop.php</a> </dd>
<dd>
<a href="http://www.php.net/manual/en/function.pack.php">http://www.php.net/manual/en/function.pack.php</a> </dd>
<dd>
<a href="http://www.php.net/manual/en/function.unpack.php">http://www.php.net/manual/en/function.unpack.php</a> </dd></dl>

<p>Definition at line <a class="el" href="SharedMemoryOp_8php_source.html#l00104">104</a> of file <a class="el" href="SharedMemoryOp_8php_source.html">SharedMemoryOp.php</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a580004299ebcba7bba9b1da4a88abf28"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MessageMedia\shmop\SharedMemoryOp::__construct </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$identifier</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$version</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$mode</em> = <code>self::MODE_READ_WRITE</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Construct a <a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html" title="Provides structure for reading and writing to shared memory segments using PHPs shmop_* functions...">SharedMemoryOp</a> object. </p>
<p>Attaches and initializes shared memory segments for the index and data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$name</td><td>Name given to this object, typically an identifier for the data being stored, i.e. soapxml, email2sms, db. </td></tr>
    <tr><td class="paramname">$identifier</td><td>A secondary identifier to be used with the $name. </td></tr>
    <tr><td class="paramname">$version</td><td>The version of the data structure being stored. </td></tr>
    <tr><td class="paramname">$mode</td><td>Mode to open shared memory segments in, defaults to read and write. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="SharedMemoryOp_8php_source.html#l00157">157</a> of file <a class="el" href="SharedMemoryOp_8php_source.html">SharedMemoryOp.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        $this-&gt;name       = <a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#af46b1a831190aed3fb5fc372de55b56f">$name</a>;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        $this-&gt;version    = <a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a662bef2e443b622b49fdfe187744c914">$version</a>;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        $this-&gt;identifier = <a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a9f8b4dfcf0544927d0ea941de4180ba9">$identifier</a>;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        $this-&gt;ipcKeyFile = self::IPC_KEY_FILE_PATH . <a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#af46b1a831190aed3fb5fc372de55b56f">$name</a> . <span class="charliteral">&#39;.&#39;</span> . <a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a9f8b4dfcf0544927d0ea941de4180ba9">$identifier</a>;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">if</span> ($mode == self::MODE_READ_ONLY) {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            $this-&gt;readOnly = <span class="keyword">true</span>;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        $this-&gt;setLogger(<span class="keyword">new</span> \Psr\Log\NullLogger());</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a3a1387fcad63b85e8851a168bcc3d0a5">initializeSharedMemorySegment</a>()) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            $this-&gt;hasError = <span class="keyword">true</span>;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;Failed to initialize shared memory segment &#39;</span> . $this-&gt;ipcKeyFile);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        }</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    }</div><div class="ttc" id="classMessageMedia_1_1shmop_1_1SharedMemoryOp_html_a662bef2e443b622b49fdfe187744c914"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a662bef2e443b622b49fdfe187744c914">MessageMedia\shmop\SharedMemoryOp\$version</a></div><div class="ttdeci">$version</div><div class="ttdoc">Version of the data structure being stored. </div><div class="ttdef"><b>Definition:</b> <a href="SharedMemoryOp_8php_source.html#l00121">SharedMemoryOp.php:121</a></div></div>
<div class="ttc" id="classMessageMedia_1_1shmop_1_1SharedMemoryOp_html_a9f8b4dfcf0544927d0ea941de4180ba9"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a9f8b4dfcf0544927d0ea941de4180ba9">MessageMedia\shmop\SharedMemoryOp\$identifier</a></div><div class="ttdeci">$identifier</div><div class="ttdoc">A secondary identifier to be used with the $name. </div><div class="ttdef"><b>Definition:</b> <a href="SharedMemoryOp_8php_source.html#l00123">SharedMemoryOp.php:123</a></div></div>
<div class="ttc" id="classMessageMedia_1_1shmop_1_1SharedMemoryOp_html_a3a1387fcad63b85e8851a168bcc3d0a5"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a3a1387fcad63b85e8851a168bcc3d0a5">MessageMedia\shmop\SharedMemoryOp\initializeSharedMemorySegment</a></div><div class="ttdeci">initializeSharedMemorySegment()</div><div class="ttdoc">Initializes a shared memory segment. </div><div class="ttdef"><b>Definition:</b> <a href="SharedMemoryOp_8php_source.html#l00195">SharedMemoryOp.php:195</a></div></div>
<div class="ttc" id="classMessageMedia_1_1shmop_1_1SharedMemoryOp_html_af46b1a831190aed3fb5fc372de55b56f"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#af46b1a831190aed3fb5fc372de55b56f">MessageMedia\shmop\SharedMemoryOp\$name</a></div><div class="ttdeci">$name</div><div class="ttdoc">Name for the shared memory segment. </div><div class="ttdef"><b>Definition:</b> <a href="SharedMemoryOp_8php_source.html#l00122">SharedMemoryOp.php:122</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a495801c80c6c22770b1cfba0345cc1b9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">MessageMedia\shmop\SharedMemoryOp::getHead </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Helper function for getting the head data (version, nextIndexOffset, nextDataOffset) from the index shared memory segment. </p>
<dl class="section return"><dt>Returns</dt><dd>Associative array containing version, nextIndexOffset and nextDataOffset from the index shared memory segment. </dd></dl>

<p>Definition at line <a class="el" href="SharedMemoryOp_8php_source.html#l00310">310</a> of file <a class="el" href="SharedMemoryOp_8php_source.html">SharedMemoryOp.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    {</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordflow">return</span> unpack(</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            <a class="code" href="classMessageMedia_1_1shmop_1_1Packing.html#aab0e87eae6338b78df993269046a5f70">Packing::getPackFormat</a>(<span class="stringliteral">&#39;head&#39;</span>, $this-&gt;<a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a99d4030b744dba40e4e857125a30ba6f">getHeadStructure</a>(), <span class="keyword">true</span>),</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            shmop_read($this-&gt;shmIndexId, 0, <a class="code" href="classMessageMedia_1_1shmop_1_1Packing.html#aa11ea1d5fd1a95de3f1b330bc63a46c9">Packing::getPackLength</a>($this-&gt;<a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a99d4030b744dba40e4e857125a30ba6f">getHeadStructure</a>()))</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        );</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    }</div><div class="ttc" id="classMessageMedia_1_1shmop_1_1Packing_html_aa11ea1d5fd1a95de3f1b330bc63a46c9"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1Packing.html#aa11ea1d5fd1a95de3f1b330bc63a46c9">MessageMedia\shmop\Packing\getPackLength</a></div><div class="ttdeci">static getPackLength($structure)</div><div class="ttdoc">Gets the length of a set of data when packed using pack with a format specified by $structure...</div><div class="ttdef"><b>Definition:</b> <a href="Packing_8php_source.html#l00087">Packing.php:87</a></div></div>
<div class="ttc" id="classMessageMedia_1_1shmop_1_1Packing_html_aab0e87eae6338b78df993269046a5f70"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1Packing.html#aab0e87eae6338b78df993269046a5f70">MessageMedia\shmop\Packing\getPackFormat</a></div><div class="ttdeci">static getPackFormat($id, $structure, $named=false)</div><div class="ttdoc">Create a pack format based on a structure for packing or unpacking. </div><div class="ttdef"><b>Definition:</b> <a href="Packing_8php_source.html#l00117">Packing.php:117</a></div></div>
<div class="ttc" id="classMessageMedia_1_1shmop_1_1SharedMemoryOp_html_a99d4030b744dba40e4e857125a30ba6f"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a99d4030b744dba40e4e857125a30ba6f">MessageMedia\shmop\SharedMemoryOp\getHeadStructure</a></div><div class="ttdeci">getHeadStructure()</div><div class="ttdoc">Returns the head structure of the index. </div><div class="ttdef"><b>Definition:</b> <a href="SharedMemoryOp_8php_source.html#l00321">SharedMemoryOp.php:321</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aeb85506a3a08b9e2eca3acd2fbba5cac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MessageMedia\shmop\SharedMemoryOp::getidentifier </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Getter for the identifier property. </p>
<dl class="section return"><dt>Returns</dt><dd>$identifier property. </dd></dl>

<p>Definition at line <a class="el" href="SharedMemoryOp_8php_source.html#l00371">371</a> of file <a class="el" href="SharedMemoryOp_8php_source.html">SharedMemoryOp.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    {</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a9f8b4dfcf0544927d0ea941de4180ba9">$this-&gt;identifier</a>;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    }</div><div class="ttc" id="classMessageMedia_1_1shmop_1_1SharedMemoryOp_html_a9f8b4dfcf0544927d0ea941de4180ba9"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a9f8b4dfcf0544927d0ea941de4180ba9">MessageMedia\shmop\SharedMemoryOp\$identifier</a></div><div class="ttdeci">$identifier</div><div class="ttdoc">A secondary identifier to be used with the $name. </div><div class="ttdef"><b>Definition:</b> <a href="SharedMemoryOp_8php_source.html#l00123">SharedMemoryOp.php:123</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aedd7d6cab3ed9c5007687fd419a48bd2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MessageMedia\shmop\SharedMemoryOp::getIpcKeyFile </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Getter for the ipcKeyFile property. </p>
<dl class="section return"><dt>Returns</dt><dd>$ipcKeyFile property. </dd></dl>

<p>Definition at line <a class="el" href="SharedMemoryOp_8php_source.html#l00381">381</a> of file <a class="el" href="SharedMemoryOp_8php_source.html">SharedMemoryOp.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a40f3d151f0cbdc48478240a40caf7ddc">$this-&gt;ipcKeyFile</a>;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    }</div><div class="ttc" id="classMessageMedia_1_1shmop_1_1SharedMemoryOp_html_a40f3d151f0cbdc48478240a40caf7ddc"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a40f3d151f0cbdc48478240a40caf7ddc">MessageMedia\shmop\SharedMemoryOp\$ipcKeyFile</a></div><div class="ttdeci">$ipcKeyFile</div><div class="ttdoc">Path to file used when creating System V IPC Key. </div><div class="ttdef"><b>Definition:</b> <a href="SharedMemoryOp_8php_source.html#l00129">SharedMemoryOp.php:129</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ada1bd3c706e07ad3cfb58d1177065017"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">MessageMedia\shmop\SharedMemoryOp::getLock </td>
          <td>(</td>
          <td class="paramtype">&amp;&#160;</td>
          <td class="paramname"><em>$fp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$lock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$timeout</em> = <code>self::LOCK_WAIT_TIMEOUT</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Attempts to get a lock on the file handle $fp within the specified timeout, specified by $timeout. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$fp</td><td>File handle to obtain lock on. </td></tr>
    <tr><td class="paramname">$lock</td><td>Type of lock exclusive or shared (LOCK_EX or LOCK_SH). </td></tr>
    <tr><td class="paramname">$timeout</td><td>Time to wait before giving up on lock in milliseconds.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if lock obtained, false otherwise</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd>Find a better location for this, a FileUtils class or something similar. </dd></dl>

<p>Definition at line <a class="el" href="SharedMemoryOp_8php_source.html#l00398">398</a> of file <a class="el" href="SharedMemoryOp_8php_source.html">SharedMemoryOp.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    {</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="comment">// Validate lock type</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="keywordflow">if</span> ($lock != LOCK_EX &amp;&amp; $lock != LOCK_SH) {</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        }</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        $startTime = microtime(<span class="keyword">true</span>);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordflow">do</span> {</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            $canWrite = flock($fp, $lock | LOCK_NB);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            <span class="comment">// If lock not obtained sleep for 0 - 10 milliseconds, to avoid collision and CPU load</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="keywordflow">if</span> (!$canWrite) {</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                $sleep = round(rand(0, 10) * 1000);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                usleep($sleep);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        } <span class="keywordflow">while</span> ((!$canWrite) &amp;&amp; ((microtime(<span class="keyword">true</span>) - $startTime) &lt; ($timeout / 1000)));</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="keywordflow">return</span> $canWrite;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    }</div></div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acf854871dda21a6a950f85119eadc624"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MessageMedia\shmop\SharedMemoryOp::getName </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Getter for the name property. </p>
<dl class="section return"><dt>Returns</dt><dd>$name property. </dd></dl>

<p>Definition at line <a class="el" href="SharedMemoryOp_8php_source.html#l00361">361</a> of file <a class="el" href="SharedMemoryOp_8php_source.html">SharedMemoryOp.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#af46b1a831190aed3fb5fc372de55b56f">$this-&gt;name</a>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    }</div><div class="ttc" id="classMessageMedia_1_1shmop_1_1SharedMemoryOp_html_af46b1a831190aed3fb5fc372de55b56f"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#af46b1a831190aed3fb5fc372de55b56f">MessageMedia\shmop\SharedMemoryOp\$name</a></div><div class="ttdeci">$name</div><div class="ttdoc">Name for the shared memory segment. </div><div class="ttdef"><b>Definition:</b> <a href="SharedMemoryOp_8php_source.html#l00122">SharedMemoryOp.php:122</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3a1387fcad63b85e8851a168bcc3d0a5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">MessageMedia\shmop\SharedMemoryOp::initializeSharedMemorySegment </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initializes a shared memory segment. </p>
<p>Creates an System V IPC Key file in /var/tmp if it doesn't already exist, attempts to obtain an exclusive lock on that file, opens the index shared memory segment and the data shared memory segment, sets or upgrades the version and sets the index offset and the data offset if not already set.</p>
<dl class="section return"><dt>Returns</dt><dd>True on successful initialization, false otherwise. </dd></dl>

<p>Definition at line <a class="el" href="SharedMemoryOp_8php_source.html#l00195">195</a> of file <a class="el" href="SharedMemoryOp_8php_source.html">SharedMemoryOp.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="keywordflow">if</span> (!extension_loaded(<span class="stringliteral">&#39;shmop&#39;</span>)) {</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            $this-&gt;hasError = <span class="keyword">true</span>;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;shmop extension not loaded&#39;</span>);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        }</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordflow">if</span> (!file_exists($this-&gt;ipcKeyFile)) {</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            <span class="keywordflow">if</span> (!$this-&gt;readOnly) {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                <span class="keywordflow">try</span> {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                    touch($this-&gt;ipcKeyFile);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                } <span class="keywordflow">catch</span> (Exception $e) {</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                    $this-&gt;hasError = <span class="keyword">true</span>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                    $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;Failed to touch &#39;</span> . $this-&gt;ipcKeyFile);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                $this-&gt;hasError = <span class="keyword">true</span>;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;File does not exist &#39;</span> . $this-&gt;ipcKeyFile);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        }</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        $ipcKeyFileHandle = fopen($this-&gt;ipcKeyFile, <span class="charliteral">&#39;r&#39;</span>);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordflow">if</span> ($ipcKeyFileHandle !== <span class="keyword">false</span>) {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="keywordflow">try</span> {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                $this-&gt;shmIndexId = $this-&gt;<a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a25a1a566f390a8885c689230343054f1">openOrCreate</a>(self::FTOK_PROJECT_INDEX_IDENTIFIER, $this-&gt;shmIndexPages);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                $this-&gt;shmDataId  = $this-&gt;<a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a25a1a566f390a8885c689230343054f1">openOrCreate</a>(self::FTOK_PROJECT_DATA_IDENTIFIER, $this-&gt;shmDataPages);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                <span class="keywordflow">if</span> ($this-&gt;shmIndexId !== <span class="keyword">false</span> &amp;&amp; $this-&gt;shmDataId !== <span class="keyword">false</span>) {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                    $head = $this-&gt;<a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a495801c80c6c22770b1cfba0345cc1b9">getHead</a>();</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                    <span class="keywordflow">if</span> (!$this-&gt;readOnly &amp;&amp; ($head[<span class="stringliteral">&#39;version&#39;</span>] == 0 || $head[<span class="stringliteral">&#39;version&#39;</span>] &lt; $this-&gt;version)) {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                        <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#ada1bd3c706e07ad3cfb58d1177065017">getLock</a>($ipcKeyFileHandle, LOCK_EX)) {</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                            $head = $this-&gt;<a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a495801c80c6c22770b1cfba0345cc1b9">getHead</a>();</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                            <span class="keywordflow">if</span> ($head[<span class="stringliteral">&#39;version&#39;</span>] == 0) {</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                                <span class="comment">// Set the version if not already set.</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                                $data = pack(</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                                    <a class="code" href="classMessageMedia_1_1shmop_1_1Packing.html#aab0e87eae6338b78df993269046a5f70">Packing::getPackFormat</a>(<span class="stringliteral">&#39;head&#39;</span>, $this-&gt;<a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a99d4030b744dba40e4e857125a30ba6f">getHeadStructure</a>()),</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                                    $this-&gt;version,</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                                    <a class="code" href="classMessageMedia_1_1shmop_1_1Packing.html#aa11ea1d5fd1a95de3f1b330bc63a46c9">Packing::getPackLength</a>($this-&gt;<a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a99d4030b744dba40e4e857125a30ba6f">getHeadStructure</a>()),</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                                    0</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                                );</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                            } elseif ($head[<span class="stringliteral">&#39;version&#39;</span>] &lt; $this-&gt;version) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                                <span class="comment">// Upgrade the version if an older version exists.</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                $data = pack($this-&gt;versionStructure[<span class="stringliteral">&#39;version&#39;</span>], $this-&gt;version);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                            }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                            shmop_write($this-&gt;shmIndexId, $data, 0);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                            flock($ipcKeyFileHandle, LOCK_UN);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                            fclose($ipcKeyFileHandle);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                            $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;Failed to obtain a lock on &#39;</span> . $this-&gt;ipcKeyFile);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                        }</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                    }</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                }</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            } <span class="keywordflow">catch</span> (Exception $e) {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                <span class="comment">// Let any exceptions fall through, and close the file</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                $this-&gt;logger-&gt;error($e-&gt;getMessage());</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            $this-&gt;logger-&gt;error(<span class="stringliteral">&#39;Failed to open &#39;</span> . $this-&gt;ipcKeyFile);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">if</span> ($this-&gt;shmIndexId !== <span class="keyword">false</span>) {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            shmop_close($this-&gt;shmIndexId);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        }</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordflow">if</span> ($this-&gt;shmDataId !== <span class="keyword">false</span>) {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            shmop_close($this-&gt;shmDataId);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        }</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        flock($ipcKeyFileHandle, LOCK_UN);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        fclose($ipcKeyFileHandle);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    }</div><div class="ttc" id="classMessageMedia_1_1shmop_1_1SharedMemoryOp_html_a495801c80c6c22770b1cfba0345cc1b9"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a495801c80c6c22770b1cfba0345cc1b9">MessageMedia\shmop\SharedMemoryOp\getHead</a></div><div class="ttdeci">getHead()</div><div class="ttdoc">Helper function for getting the head data (version, nextIndexOffset, nextDataOffset) from the index s...</div><div class="ttdef"><b>Definition:</b> <a href="SharedMemoryOp_8php_source.html#l00310">SharedMemoryOp.php:310</a></div></div>
<div class="ttc" id="classMessageMedia_1_1shmop_1_1Packing_html_aa11ea1d5fd1a95de3f1b330bc63a46c9"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1Packing.html#aa11ea1d5fd1a95de3f1b330bc63a46c9">MessageMedia\shmop\Packing\getPackLength</a></div><div class="ttdeci">static getPackLength($structure)</div><div class="ttdoc">Gets the length of a set of data when packed using pack with a format specified by $structure...</div><div class="ttdef"><b>Definition:</b> <a href="Packing_8php_source.html#l00087">Packing.php:87</a></div></div>
<div class="ttc" id="classMessageMedia_1_1shmop_1_1Packing_html_aab0e87eae6338b78df993269046a5f70"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1Packing.html#aab0e87eae6338b78df993269046a5f70">MessageMedia\shmop\Packing\getPackFormat</a></div><div class="ttdeci">static getPackFormat($id, $structure, $named=false)</div><div class="ttdoc">Create a pack format based on a structure for packing or unpacking. </div><div class="ttdef"><b>Definition:</b> <a href="Packing_8php_source.html#l00117">Packing.php:117</a></div></div>
<div class="ttc" id="classMessageMedia_1_1shmop_1_1SharedMemoryOp_html_a99d4030b744dba40e4e857125a30ba6f"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a99d4030b744dba40e4e857125a30ba6f">MessageMedia\shmop\SharedMemoryOp\getHeadStructure</a></div><div class="ttdeci">getHeadStructure()</div><div class="ttdoc">Returns the head structure of the index. </div><div class="ttdef"><b>Definition:</b> <a href="SharedMemoryOp_8php_source.html#l00321">SharedMemoryOp.php:321</a></div></div>
<div class="ttc" id="classMessageMedia_1_1shmop_1_1SharedMemoryOp_html_a25a1a566f390a8885c689230343054f1"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a25a1a566f390a8885c689230343054f1">MessageMedia\shmop\SharedMemoryOp\openOrCreate</a></div><div class="ttdeci">openOrCreate($projectIdentifier, $pages)</div><div class="ttdoc">Opens or creates a shared memory segment. </div><div class="ttdef"><b>Definition:</b> <a href="SharedMemoryOp_8php_source.html#l00281">SharedMemoryOp.php:281</a></div></div>
<div class="ttc" id="classMessageMedia_1_1shmop_1_1SharedMemoryOp_html_ada1bd3c706e07ad3cfb58d1177065017"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#ada1bd3c706e07ad3cfb58d1177065017">MessageMedia\shmop\SharedMemoryOp\getLock</a></div><div class="ttdeci">getLock(&amp;$fp, $lock, $timeout=self::LOCK_WAIT_TIMEOUT)</div><div class="ttdoc">Attempts to get a lock on the file handle $fp within the specified timeout, specified by $timeout...</div><div class="ttdef"><b>Definition:</b> <a href="SharedMemoryOp_8php_source.html#l00398">SharedMemoryOp.php:398</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a23377d1e4cedd9c6847091c3778d9f28"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">MessageMedia\shmop\SharedMemoryOp::isError </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the value of hasError. </p>
<dl class="section return"><dt>Returns</dt><dd>True if hasError is true, false otherwise. </dd></dl>

<p>Definition at line <a class="el" href="SharedMemoryOp_8php_source.html#l00351">351</a> of file <a class="el" href="SharedMemoryOp_8php_source.html">SharedMemoryOp.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#aa0651379f6bbeb81af861887f942942e">$this-&gt;hasError</a>;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    }</div><div class="ttc" id="classMessageMedia_1_1shmop_1_1SharedMemoryOp_html_aa0651379f6bbeb81af861887f942942e"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#aa0651379f6bbeb81af861887f942942e">MessageMedia\shmop\SharedMemoryOp\$hasError</a></div><div class="ttdeci">$hasError</div><div class="ttdoc">Flag any permanent errors. </div><div class="ttdef"><b>Definition:</b> <a href="SharedMemoryOp_8php_source.html#l00130">SharedMemoryOp.php:130</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a25a1a566f390a8885c689230343054f1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">MessageMedia\shmop\SharedMemoryOp::openOrCreate </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$projectIdentifier</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$pages</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Opens or creates a shared memory segment. </p>
<p>Attempts to open a shared memory segment for the specifed project identifier. If the segment cannot be opened, attempts to create the shared memory segment.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">$projectIdentifier</td><td>Project identifier to use in ftok call. </td></tr>
    <tr><td class="paramname">$pages</td><td>Size of shared memory segment if being created.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>An shared memory segment ID on success, false otherwise. </dd></dl>

<p>Definition at line <a class="el" href="SharedMemoryOp_8php_source.html#l00281">281</a> of file <a class="el" href="SharedMemoryOp_8php_source.html">SharedMemoryOp.php</a>.</p>
<div class="fragment"><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        $key = ftok($this-&gt;ipcKeyFile, $projectIdentifier);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="keywordflow">if</span> (is_long($key) &amp;&amp; $key != -1) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            $mode = (<a class="code" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a9a114fa3971b7700246999c7c4152b9b">$this-&gt;readOnly</a>) ? <span class="charliteral">&#39;a&#39;</span> : <span class="charliteral">&#39;w&#39;</span>;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            @$shmId = shmop_open($key, $mode, 0, 0);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <span class="keywordflow">if</span> ($shmId !== <span class="keyword">false</span>) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                $this-&gt;logger-&gt;debug(<span class="stringliteral">&#39;Opened shared memory segment 0x&#39;</span> . dechex($key));</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                <span class="keywordflow">return</span> $shmId;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                <span class="keywordflow">if</span> (!$this-&gt;readOnly) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                    $shmId = shmop_open($key, <span class="charliteral">&#39;c&#39;</span>, self::SHARED_MEMORY_MODE, $pages * self::PAGE_SIZE);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                    <span class="keywordflow">if</span> ($shmId !== <span class="keyword">false</span>) {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                        $this-&gt;logger-&gt;info(<span class="stringliteral">&#39;Created and opened shared memory segment 0x&#39;</span> . dechex($key));</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                        <span class="keywordflow">return</span> $shmId;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                    }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                }</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    }</div><div class="ttc" id="classMessageMedia_1_1shmop_1_1SharedMemoryOp_html_a9a114fa3971b7700246999c7c4152b9b"><div class="ttname"><a href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html#a9a114fa3971b7700246999c7c4152b9b">MessageMedia\shmop\SharedMemoryOp\$readOnly</a></div><div class="ttdeci">$readOnly</div><div class="ttdoc">Open shared memory segments as read only. </div><div class="ttdef"><b>Definition:</b> <a href="SharedMemoryOp_8php_source.html#l00131">SharedMemoryOp.php:131</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a9f686dd9edce30ea188f69489a0a5764"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">MessageMedia\shmop\SharedMemoryOp::$offsetsStructure</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= array(</div><div class="line">        <span class="stringliteral">&#39;nextIndexOffset&#39;</span> =&gt; <a class="code" href="classMessageMedia_1_1shmop_1_1Packing.html#ad23da1bd65407f7c02dad9d2de818228">Packing::UINT32</a>, </div><div class="line">        <span class="stringliteral">&#39;nextDataOffset&#39;</span>  =&gt; <a class="code" href="classMessageMedia_1_1shmop_1_1Packing.html#ad23da1bd65407f7c02dad9d2de818228">Packing::UINT32</a>, </div><div class="line">    )</div></div><!-- fragment --><p>Structure of the head stored in the index segment. </p><dl class="section see"><dt>See also</dt><dd><a href="http://php.net/manual/en/function.pack.php">http://php.net/manual/en/function.pack.php</a>. </dd></dl>

<p>Definition at line <a class="el" href="SharedMemoryOp_8php_source.html#l00141">141</a> of file <a class="el" href="SharedMemoryOp_8php_source.html">SharedMemoryOp.php</a>.</p>

</div>
</div>
<a class="anchor" id="a8b9da8603edb684c107435d2eb4a3e9b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">MessageMedia\shmop\SharedMemoryOp::$versionStructure</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= array(</div><div class="line">        <span class="stringliteral">&#39;version&#39;</span> =&gt; <a class="code" href="classMessageMedia_1_1shmop_1_1Packing.html#ad23da1bd65407f7c02dad9d2de818228">Packing::UINT32</a>,    </div><div class="line">    )</div></div><!-- fragment --><p>Structure of the version stored in the head of the index segment. </p><dl class="section see"><dt>See also</dt><dd><a href="http://php.net/manual/en/function.pack.php">http://php.net/manual/en/function.pack.php</a>. </dd></dl>

<p>Definition at line <a class="el" href="SharedMemoryOp_8php_source.html#l00135">135</a> of file <a class="el" href="SharedMemoryOp_8php_source.html">SharedMemoryOp.php</a>.</p>

</div>
</div>
<a class="anchor" id="ada4f2481df07a80e575531d9a168e316"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const MessageMedia\shmop\SharedMemoryOp::IPC_KEY_FILE_PATH = '/var/tmp/'</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Path to use when creating System V IPC key. Must match the corresponding PMDA implementation. </p>

<p>Definition at line <a class="el" href="SharedMemoryOp_8php_source.html#l00112">112</a> of file <a class="el" href="SharedMemoryOp_8php_source.html">SharedMemoryOp.php</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/<a class="el" href="SharedMemoryOp_8php_source.html">SharedMemoryOp.php</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>MessageMedia</b></li><li class="navelem"><b>shmop</b></li><li class="navelem"><a class="el" href="classMessageMedia_1_1shmop_1_1SharedMemoryOp.html">SharedMemoryOp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
